{"pages":[],"posts":[{"title":"docker的redis服务运行一段时间后无法连接","text":"定位问题查看redis日志1234567891011121314[root@cloud ~]# docker logs xxx | less...1:M 17 Sep 2020 00:59:36.287 * 100 changes in 300 seconds. Saving...1:M 17 Sep 2020 00:59:36.690 * Background saving started by pid 1264712647:C 17 Sep 2020 01:00:26.706 # Write error saving DB on disk: No space left on device1:M 17 Sep 2020 01:00:27.646 # Background saving error1:M 17 Sep 2020 01:00:27.746 * 100 changes in 300 seconds. Saving...1:M 17 Sep 2020 01:00:28.243 * Background saving started by pid 1264812648:C 17 Sep 2020 01:01:06.715 # Write error saving DB on disk: No space left on device1:M 17 Sep 2020 01:01:07.749 # Background saving error1:M 17 Sep 2020 01:01:07.850 * 100 changes in 300 seconds. Saving...1:M 17 Sep 2020 01:01:08.348 * Background saving started by pid 1264912649:C 17 Sep 2020 01:01:46.865 # Write error saving DB on disk: No space left on device1:M 17 Sep 2020 01:01:47.763 # Background saving error 大概意思是持久化时存储位置磁盘空间不足导致写入错误。 查看存储位置以及剩余空间余量1234567[root@cloud ~]# docker info | less...Docker Root Dir: /mnt/data2/Container/docker...[root@cloud ~]# docker infoFilesystem Size Used Avail Use% Mounted on/dev/nvme0n1 477G 475G 2.3G 100% /mnt/data2 可以看到已经无剩余的空间了 解决办法 修改redis.conf持久化存储路径docker安装的redis默认是没有配置文件的，修改还要加redis.conf配置文件、映射外部路径到容器等操作，比较麻烦。 存储扩容 修改docker的Docker Root Dir 12345678910[root@cloud ~]# vi /etc/docker/daemon.json{ &quot;data-root&quot;: &quot;/cloud/docker&quot;}[root@cloud ~]# systemctl daemon-reload[root@cloud ~]# systemctl restart docker.service[root@cloud ~]# docker info | less...Docker Root Dir: /cloud/docker... 直接修改docker的根目录，但是无法使用以前的镜像、容器等,所以此方法不推荐 使用软连接1234[root@cloud ~]# cp -rf /mnt/data2/Container/docker/* /cloud/docker/[root@cloud ~]# rm -rf /mnt/data2/Container/docker[root@cloud ~]# ln -s /cloud/docker/ /mnt/data2/Container/docker[root@cloud ~]# systemctl restart docker.service 数据完美迁移，能保留数据，也不用改配置，而且操作也简单，推荐！","link":"/2020/09/17/docker%E7%9A%84redis%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8C%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%90%8E%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5/"},{"title":"解决php突然无法上传文件问题","text":"问题描述昨天还好好的，今天突然收到网站所有文件都无法上传，先调试打印上传的文件，发现所有能获取到文件名，但是所有其他参数都为空。 查看Nginx日志，有如下报错： 12[error] 4197#0: *109393 FastCGI sent in stderr: &quot;PHP message: PHP Warning: File upload error - unable to create a temporary file in Unknown on line 0 解决办法有错误信息一般就解决了一半问题了，谷歌走起： 排除是否为tmp目录问题php上传文件会先放入tmp目录，所以运行Nginx的用户必须有写入权限，可使用如下代码获取PHP的tmp目录：12$tmp_dir = ini_get('upload_tmp_dir') ? ini_get('upload_tmp_dir') : sys_get_temp_dir();die($tmp_dir); #一般情况是/tmp 检查tmp目录是否为777权限 检查tmp目录是否有足够的空间。 重启nginx和php-fpm1sudo systemctl restart php-fpm nginx 我的tmp目录满足条件，用方法2解决了问题，但是具体原因未知…","link":"/2020/09/22/%E8%A7%A3%E5%86%B3php%E7%AA%81%E7%84%B6%E6%97%A0%E6%B3%95%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E9%97%AE%E9%A2%98/"}],"tags":[],"categories":[]}